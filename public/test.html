<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Main Page</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-min.css" rel="stylesheet">
    <link href="/public/assets/css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/parse/2.12.0/parse.js"></script>
  </head>

  <body>
  	<p id="currentUser"></p>
  	<button onclick="logOut()">Wyloguj sie</button> 
  	<button onclick="location.href='/log_in';">Zaloguj sie</button> 
  	<button onclick="location.href='/sign_up';">Zarejestruj sie</button> 
  	<div id="app">
  		<input type="text" id="new-post" name="new-post"></body>
  		<button v-on:click="addPost">Dodaj post</button> 
  		<p v-for="post in posts" id="post" name="post">Author: {{post[0]}} Post: {{post[1]}} Created at: {{post[2]}}</p>
  	</div>
  	<script type="text/javascript", src="/user_actions.js"></script>
  	<script type="text/javascript", src="/post_actions.js"></script>
  	<script type="text/javascript">
  		var app = new Vue({
	        el: '#app',
	        data: {
	          posts: [],
	          user: {}
	        },
	        methods: {
	        	populatePostsData: function () {
	        		getAndFormatPosts()
	        			.then(function (success) {
	        				app.posts = success.reverse();
	        			})
	        	},
	        	addPost: function() {
	        		let postBody = document.getElementById("new-post").value;
  					addPostToDatabase(postBody).then(() => {this.populatePostsData()});
	        	},
	        	getUsername: function() {
	        		app.user = getCurrentUser();
	        		if (user === null) {

	        		} else {

	        		}

	        	},
	        	checkForNewPosts: function() {
	        		setInterval(this.populatePostsData, 10000);
	        	}
	        }
      	});
  		app.populatePostsData();
  		app.checkForNewPosts();
  		currentUser = document.getElementById("currentUser");
  		currentUser.innerHTML = getCurrentUser();
  		function logOut() {
  			logOutCurrentUser();
  		}

  	</script>
  </body>
</html>
